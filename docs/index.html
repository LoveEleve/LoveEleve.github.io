<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>LoveEleve's Tech Blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
  <meta name="referrer" content="no-referrer" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css" />

  <style>
    :root {
      --theme-color: #42b983;
      --sidebar-width: 250px;
      --content-max-width: 850px;
      --base-font-size: 13px;

      --code-border: rgba(0, 0, 0, 0.06);
      --code-toolbar-bg: #f6f8fa;
      --code-gutter-bg: #f6f8fa;
      --code-text: #24292f;
      --code-muted: #8b949e;
    }

    /* 侧边栏：首页不展示“页面内目录” */
    .sidebar-nav a[href="#/"] + ul,
    .sidebar-nav a[href="#/README"] + ul {
      display: none !important;
    }
    .sidebar-nav a[href="#/"]::after,
    .sidebar-nav a[href="#/README"]::after {
      display: none !important;
    }

    /* ---------------- 代码块：统一顶栏 + 行级折叠（直接在代码块内） ---------------- */
    pre[data-lang] {
      position: relative !important;
      margin: 1.5em 0 !important;
      padding: 3.1em 0 0 !important; /* 顶部留工具栏 */
      border-radius: 12px !important;
      border: 1px solid rgba(0, 0, 0, 0.08) !important;
      background: #ffffff !important;
      overflow: hidden;
      box-shadow:
        0 1px 0 rgba(0, 0, 0, 0.02),
        0 12px 28px rgba(0, 0, 0, 0.06);
      transition: box-shadow 0.2s ease, transform 0.2s ease;
    }

    pre[data-lang]:hover {
      box-shadow:
        0 1px 0 rgba(0, 0, 0, 0.02),
        0 16px 34px rgba(0, 0, 0, 0.08);
    }

    pre[data-lang].is-collapsed {
      max-height: 44px !important;
      padding-bottom: 0 !important;
      cursor: pointer;
    }

    .code-tools {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 34px;
      padding: 0 12px;
      background: linear-gradient(180deg, rgba(246, 248, 250, 0.98), rgba(246, 248, 250, 0.92));
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
      user-select: none;
      backdrop-filter: saturate(180%) blur(10px);
      -webkit-backdrop-filter: saturate(180%) blur(10px);
    }

    .code-tools-left {
      font-size: 11px;
      color: var(--code-muted);
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.7px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* macOS 风格三色点 */
    .code-tools-left .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.08);
    }

    .code-tools-left .dot:nth-of-type(1) { background: #ff5f57; }
    .code-tools-left .dot:nth-of-type(2) { background: #febc2e; }
    .code-tools-left .dot:nth-of-type(3) { background: #28c840; }

    .code-tools-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .tool-btn {
      font-size: 11px;
      color: var(--theme-color);
      cursor: pointer;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(66, 185, 131, 0.22);
      background: rgba(66, 185, 131, 0.08);
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.15s ease;
      line-height: 1;
    }

    .tool-btn:hover {
      background: rgba(66, 185, 131, 0.14);
      border-color: rgba(66, 185, 131, 0.30);
      transform: translateY(-1px);
    }

    .tool-btn:active {
      transform: translateY(0);
    }

    /* 禁用 docsify-copy-code 的按钮（我们自己实现复制并放到顶栏） */
    .docsify-copy-code-button {
      display: none !important;
    }

    /* 行级折叠布局 */
    .fold-wrap {
      display: flex;
      background: #fff;
    }

    .fold-gutter {
      flex: 0 0 26px;
      background: transparent;
      border-right: 1px solid rgba(0, 0, 0, 0.04);
      user-select: none;
      padding: 10px 0;
    }

    .fold-gutter-row {
      height: 1.55em;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .fold-toggle {
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.15s ease;
    }

    .fold-toggle:hover {
      background: rgba(66, 185, 131, 0.10);
    }

    .fold-toggle svg {
      width: 14px;
      height: 14px;
      fill: #8b949e;
      transition: transform 0.15s ease, fill 0.15s ease;
    }

    .fold-toggle:hover svg {
      fill: var(--theme-color);
    }

    .fold-toggle.is-folded svg {
      transform: rotate(-90deg);
    }

    /* 不展示行号，只保留折叠三角 */
    .fold-line-no {
      display: none;
    }

    .fold-code-scroll {
      flex: 1;
      overflow-x: auto;
      padding: 10px 0;
    }

    /* 关键：不要用 flex 渲染代码行，避免空白字符黏连导致“代码变形” */
    .fold-code-row {
      display: block;
      padding: 0 14px;
      white-space: pre;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      line-height: 1.55em;
      color: var(--code-text);
    }

    .fold-code-row.is-hidden {
      display: none;
    }

    .fold-ellipsis {
      display: none;
      margin-left: 10px;
      padding: 0 8px;
      border-radius: 999px;
      background: rgba(66, 185, 131, 0.10);
      color: var(--theme-color);
      font-size: 12px;
      cursor: pointer;
      user-select: none;
    }

    .fold-code-row.is-fold-head .fold-ellipsis {
      display: inline-block;
    }

    /* 在折叠状态，给起始行稍微高亮 */
    .fold-code-row.is-fold-head {
      background: rgba(66, 185, 131, 0.04);
    }

    /* 让 Prism token 样式还能生效（我们仍使用 Prism.highlight 输出 token span） */
    .fold-code-row .token.comment,
    .fold-code-row .token.prolog,
    .fold-code-row .token.doctype,
    .fold-code-row .token.cdata {
      color: #999;
    }

    /* ---------------- 评论区（giscus） ---------------- */
    .markdown-section #giscus {
      margin-top: 28px;
    }

    .markdown-section #giscus .giscus-card {
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #fff;
      overflow: hidden;
      box-shadow:
        0 1px 0 rgba(0, 0, 0, 0.02),
        0 12px 28px rgba(0, 0, 0, 0.06);
    }

    .markdown-section #giscus .giscus-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: linear-gradient(180deg, rgba(246, 248, 250, 0.98), rgba(246, 248, 250, 0.92));
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      backdrop-filter: saturate(180%) blur(10px);
      -webkit-backdrop-filter: saturate(180%) blur(10px);
    }

    .markdown-section #giscus .giscus-head-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .markdown-section #giscus .giscus-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: #1f2328;
    }

    .markdown-section #giscus .giscus-meta {
      font-size: 12px;
      color: var(--code-muted);
    }

    .markdown-section #giscus .giscus-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(66, 185, 131, 0.22);
      background: rgba(66, 185, 131, 0.08);
      color: var(--theme-color);
      font-size: 11px;
      font-weight: 700;
      line-height: 1;
      text-decoration: none;
    }

    .markdown-section #giscus .giscus-badge:hover {
      background: rgba(66, 185, 131, 0.14);
      border-color: rgba(66, 185, 131, 0.30);
    }

    .markdown-section #giscus .giscus-body {
      padding: 12px 14px 16px;
    }

    .markdown-section #giscus .giscus-body:empty {
      display: none;
    }

    .markdown-section .giscus-frame {
      width: 100%;
    }

    /* ---------------- 文章元信息（更新时间 / 阅读时长 / 字数） ---------------- */
    .page-meta-card {
      margin: 18px 0 18px;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #fff;
      overflow: hidden;
      box-shadow:
        0 1px 0 rgba(0, 0, 0, 0.02),
        0 12px 28px rgba(0, 0, 0, 0.06);
    }

    .page-meta-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: linear-gradient(180deg, rgba(246, 248, 250, 0.98), rgba(246, 248, 250, 0.92));
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      backdrop-filter: saturate(180%) blur(10px);
      -webkit-backdrop-filter: saturate(180%) blur(10px);
    }

    .page-meta-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: #1f2328;
    }

    .page-meta-body {
      padding: 10px 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      color: #57606a;
      font-size: 13px;
      line-height: 1.6;
    }

    .page-meta-body b {
      color: #1f2328;
      font-weight: 800;
    }

    .page-meta-sep {
      opacity: 0.5;
      padding: 0 2px;
    }

    .page-tip {
      padding: 10px 14px;
      border-top: 1px dashed rgba(0, 0, 0, 0.10);
      background: rgba(66, 185, 131, 0.06);
      color: #1f2328;
      font-size: 13px;
    }

    .page-tip b {
      color: var(--theme-color);
    }

    /* ---------------- 右侧 TOC（目录增强） ---------------- */
    .toc-aside {
      position: fixed;
      top: 86px;
      right: 18px;
      width: 260px;
      max-height: calc(100vh - 110px);
      overflow: auto;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #fff;
      box-shadow:
        0 1px 0 rgba(0, 0, 0, 0.02),
        0 12px 28px rgba(0, 0, 0, 0.06);
      z-index: 20;
      display: none;
    }

    .toc-head {
      position: sticky;
      top: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: linear-gradient(180deg, rgba(246, 248, 250, 0.98), rgba(246, 248, 250, 0.92));
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      backdrop-filter: saturate(180%) blur(10px);
      -webkit-backdrop-filter: saturate(180%) blur(10px);
    }

    .toc-title {
      font-size: 12px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: #1f2328;
    }

    .toc-body {
      padding: 10px 10px 12px;
      font-size: 12px;
      line-height: 1.55;
      color: #57606a;
    }

    .toc-body a {
      display: block;
      padding: 6px 8px;
      border-radius: 8px;
      color: inherit;
      text-decoration: none;
      border: 1px solid transparent;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .toc-body a:hover {
      background: rgba(66, 185, 131, 0.08);
      border-color: rgba(66, 185, 131, 0.18);
      color: #1f2328;
    }

    .toc-body a.is-active {
      background: rgba(66, 185, 131, 0.12);
      border-color: rgba(66, 185, 131, 0.26);
      color: #1f2328;
      font-weight: 800;
    }

    .toc-l2 { padding-left: 0; }
    .toc-l3 { padding-left: 12px; }
    .toc-l4 { padding-left: 22px; opacity: 0.95; }

    /* 只在大屏显示右侧 TOC，并给内容留出空间 */
    @media (min-width: 1200px) {
      .toc-aside { display: block; }
      .content { padding-right: 300px; }
    }

    @media (max-width: 1199px) {
      .toc-aside { display: none; }
      .content { padding-right: 0; }
    }

    /* ---------------- 阅读体验增强：进度条 / 面包屑 / 上一篇下一篇 ---------------- */
    #read-progress {
      position: fixed;
      top: 0;
      left: 0;
      height: 3px;
      width: 0;
      background: var(--theme-color);
      z-index: 999;
      transition: width 0.08s linear;
    }

    .page-breadcrumb {
      margin: 10px 0 12px;
      font-size: 12px;
      line-height: 1.5;
      color: var(--code-muted);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
    }

    .page-breadcrumb a {
      color: inherit;
      text-decoration: none;
      border-bottom: 1px dashed rgba(66, 185, 131, 0.25);
    }

    .page-breadcrumb a:hover {
      color: #1f2328;
      border-bottom-color: rgba(66, 185, 131, 0.55);
    }

    .page-breadcrumb .crumb-sep {
      opacity: 0.5;
    }

    .page-nav {
      margin: 18px 0 26px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .page-nav a {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: #fff;
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.02);
      text-decoration: none;
      color: #1f2328;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .page-nav a:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.06);
      border-color: rgba(66, 185, 131, 0.25);
    }

    .page-nav .nav-kicker {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.6px;
      text-transform: uppercase;
      color: var(--code-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .page-nav .nav-title {
      font-size: 13px;
      font-weight: 800;
      color: #1f2328;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .page-nav .is-disabled {
      opacity: 0.45;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      .page-nav {
        grid-template-columns: 1fr;
      }
    }

    /* 侧边栏样式 */
    .sidebar-nav > ul > li {
      margin: 10px 0;
      font-weight: bold;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="app">正在加载...</div>

  <script>
    window.$docsify = {
      name: 'LoveEleve',
      repo: 'https://github.com/LoveEleve/LoveEleve.github.io',
      loadSidebar: true,
      alias: { '/.*/_sidebar.md': '/_sidebar.md' },
      subMaxLevel: 3,
      sidebarDisplayLevel: 0,
      executeScript: true,
      requestHeaders: { 'cache-control': 'max-age=0' },
      auto2top: true,

      plugins: [
        function (hook, vm) {
          function escapeHtml(str) {
            return str
              .replace(/&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;')
              .replace(/"/g, '&quot;')
              .replace(/'/g, '&#39;');
          }

          function safeHighlight(line, lang) {
            try {
              if (window.Prism && Prism.languages && Prism.languages[lang]) {
                return Prism.highlight(line, Prism.languages[lang], lang);
              }
            } catch (e) {
              // ignore
            }
            return escapeHtml(line);
          }

          function buildFoldBlocks(lines) {
            // 轻量括号匹配：尽量忽略字符串/注释里的 { }
            const blocks = [];
            const stack = [];
            let inBlockComment = false;
            let inString = null; // ' or "
            let escape = false;

            function scanLine(line) {
              let openCount = 0;
              let closeCount = 0;
              for (let i = 0; i < line.length; i++) {
                const ch = line[i];
                const next = i + 1 < line.length ? line[i + 1] : '';

                if (escape) {
                  escape = false;
                  continue;
                }

                if (inString) {
                  if (ch === '\\') {
                    escape = true;
                    continue;
                  }
                  if (ch === inString) {
                    inString = null;
                  }
                  continue;
                }

                if (inBlockComment) {
                  if (ch === '*' && next === '/') {
                    inBlockComment = false;
                    i++;
                  }
                  continue;
                }

                // 行注释
                if (ch === '/' && next === '/') break;

                // 块注释
                if (ch === '/' && next === '*') {
                  inBlockComment = true;
                  i++;
                  continue;
                }

                // 字符串开始
                if (ch === '"' || ch === "'") {
                  inString = ch;
                  continue;
                }

                if (ch === '{') openCount++;
                if (ch === '}') closeCount++;
              }
              return { openCount, closeCount };
            }

            lines.forEach((line, idx) => {
              const { openCount, closeCount } = scanLine(line);

              for (let i = 0; i < openCount; i++) stack.push(idx);
              for (let i = 0; i < closeCount; i++) {
                if (stack.length === 0) continue;
                const start = stack.pop();
                const end = idx;
                // 至少折叠 2 行以上才有意义
                if (end >= start + 2) blocks.push({ start, end, folded: false });
              }
            });

            blocks.sort((a, b) => (a.start - b.start) || (b.end - a.end));
            return blocks;
          }

          // 性能兜底：超长代码块不要做“逐行 DOM 折叠”，避免页面卡顿
          const INLINE_FOLD_MAX_LINES = 360;

          function initInlineFolding(pre) {
            const langRaw = (pre.getAttribute('data-lang') || '').toLowerCase();
            const lang = langRaw === 'plain' ? 'markup' : langRaw;

            const codeEl = pre.querySelector('code');
            if (!codeEl) return;

            // 取“纯文本代码”，避免把 token span 再次解析
            const raw = (codeEl.textContent || '').replace(/\n$/, '');
            const lines = raw.split('\n');

            // 超长代码块：保留原生 Prism 渲染（更省 DOM），只保留复制/整块收起
            if (lines.length > INLINE_FOLD_MAX_LINES) {
              pre.dataset.rawCode = raw;
              pre.dataset.inlineFoldSkipped = '1';
              return;
            }

            // 生成折叠结构
            const blocks = buildFoldBlocks(lines);
            const blocksByStart = new Map();
            blocks.forEach((b) => {
              if (!blocksByStart.has(b.start)) blocksByStart.set(b.start, []);
              blocksByStart.get(b.start).push(b);
            });

            // 清空原 code 内容，改为“同一个代码块内”的行级结构
            codeEl.innerHTML = '';

            const wrap = document.createElement('div');
            wrap.className = 'fold-wrap';

            const gutter = document.createElement('div');
            gutter.className = 'fold-gutter';

            const codeScroll = document.createElement('div');
            codeScroll.className = 'fold-code-scroll';

            wrap.appendChild(gutter);
            wrap.appendChild(codeScroll);
            codeEl.appendChild(wrap);

            const gutterRows = new Array(lines.length);
            const codeRows = new Array(lines.length);
            const ellipsisByStart = new Map();
            const toggleByStart = new Map();

            function makeChevron() {
              const span = document.createElement('span');
              span.className = 'fold-toggle';
              span.innerHTML = '<svg viewBox="0 0 16 16" aria-hidden="true"><path d="M4.5 6.5L8 10l3.5-3.5"/></svg>';
              return span;
            }

            for (let i = 0; i < lines.length; i++) {
              const gr = document.createElement('div');
              gr.className = 'fold-gutter-row';

              const startBlocks = blocksByStart.get(i);
              if (startBlocks && startBlocks.length) {
                const toggle = makeChevron();
                gr.appendChild(toggle);
                toggleByStart.set(i, toggle);
              } else {
                const spacer = document.createElement('span');
                spacer.style.width = '14px';
                spacer.style.display = 'inline-block';
                gr.appendChild(spacer);
              }

              const ln = document.createElement('span');
              ln.className = 'fold-line-no';
              ln.textContent = String(i + 1);
              gr.appendChild(ln);

              gutter.appendChild(gr);
              gutterRows[i] = gr;

              const cr = document.createElement('div');
              cr.className = 'fold-code-row';

              const html = safeHighlight(lines[i], lang);
              cr.innerHTML = html || '&nbsp;';

              const ell = document.createElement('span');
              ell.className = 'fold-ellipsis';
              ell.textContent = '…';
              cr.appendChild(ell);
              ellipsisByStart.set(i, ell);

              codeScroll.appendChild(cr);
              codeRows[i] = cr;
            }

            function recompute() {
              const hidden = new Array(lines.length).fill(false);

              // reset
              for (let i = 0; i < lines.length; i++) {
                codeRows[i].classList.remove('is-fold-head');
                const ell = ellipsisByStart.get(i);
                if (ell) {
                  ell.style.display = 'none';
                  ell.textContent = '…';
                }
              }

              blocks.forEach((b) => {
                if (!b.folded) return;
                for (let i = b.start + 1; i <= b.end; i++) hidden[i] = true;

                // start 行展示 ellipsis
                codeRows[b.start].classList.add('is-fold-head');
                const ell = ellipsisByStart.get(b.start);
                if (ell) {
                  const count = b.end - b.start;
                  ell.style.display = 'inline-block';
                  ell.textContent = `… ${count} 行`;
                }
              });

              for (let i = 0; i < lines.length; i++) {
                const isHidden = hidden[i];
                gutterRows[i].style.display = isHidden ? 'none' : 'flex';
                codeRows[i].classList.toggle('is-hidden', isHidden);
              }

              // update toggle states
              toggleByStart.forEach((toggle, start) => {
                const startBlocks = blocksByStart.get(start) || [];
                const anyFolded = startBlocks.some((b) => b.folded);
                toggle.classList.toggle('is-folded', anyFolded);
              });
            }

            // bind toggle events
            toggleByStart.forEach((toggle, start) => {
              const startBlocks = blocksByStart.get(start) || [];

              // 同一行若有多个 block（极少见），优先折叠“最长的”更符合直觉
              const pick = startBlocks.reduce((acc, cur) => {
                const accLen = acc.end - acc.start;
                const curLen = cur.end - cur.start;
                return curLen > accLen ? cur : acc;
              }, startBlocks[0]);

              toggle.onclick = (e) => {
                e.stopPropagation();
                pick.folded = !pick.folded;
                recompute();
              };

              const ell = ellipsisByStart.get(start);
              if (ell) {
                ell.onclick = (e) => {
                  e.stopPropagation();
                  pick.folded = false;
                  recompute();
                };
              }
            });

            // 初始全展开
            recompute();

            // 保留原始文本用于复制
            pre.dataset.rawCode = raw;
          }

          function initToolbar(pre) {
            if (pre.querySelector('.code-tools')) return;

            const lang = (pre.getAttribute('data-lang') || '').toUpperCase();

            const tools = document.createElement('div');
            tools.className = 'code-tools';
            tools.innerHTML = `
              <div class="code-tools-left">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span>${lang}</span>
              </div>
              <div class="code-tools-right">
                <span class="tool-btn btn-copy">复制</span>
                <span class="tool-btn btn-toggle">收起代码</span>
              </div>
            `;

            pre.insertBefore(tools, pre.firstChild);

            const copyBtn = tools.querySelector('.btn-copy');
            const toggleBtn = tools.querySelector('.btn-toggle');

            copyBtn.onclick = function (e) {
              e.stopPropagation();
              const text = pre.dataset.rawCode || '';
              navigator.clipboard.writeText(text).then(() => {
                copyBtn.textContent = '已复制';
                setTimeout(() => {
                  copyBtn.textContent = '复制';
                }, 1200);
              });
            };

            const handleToggle = function (e) {
              if (e) e.stopPropagation();
              const isCollapsed = pre.classList.toggle('is-collapsed');
              toggleBtn.textContent = isCollapsed ? '展开代码' : '收起代码';
            };

            toggleBtn.onclick = handleToggle;
            pre.onclick = function () {
              if (pre.classList.contains('is-collapsed')) handleToggle();
            };
          }

          const GISCUS_CFG = {
            src: 'https://giscus.app/client.js',
            repo: 'LoveEleve/LoveEleve.github.io',
            repoId: 'R_kgDOQ7i-XQ',
            category: 'Announcements',
            categoryId: 'DIC_kwDOQ7i-Xc4C1Edj',
            mapping: 'specific',
            strict: '0',
            reactionsEnabled: '1',
            emitMetadata: '0',
            inputPosition: 'bottom',
            // 固定为浅色主题，避免系统深色模式导致评论区黑底与正文风格冲突
            theme: 'light',
            lang: 'zh-CN'
          };

          function getGiscusTerm(vm) {
            // 让每个 Docsify 路由对应一个 discussion（避免全站串楼）
            let path = (vm && vm.route && vm.route.path) ? vm.route.path : '';
            if (!path) {
              path = (location.hash || '#/').replace(/^#/, '').split('?')[0];
            }
            if (!path || path === '/') path = '/README';
            try {
              path = decodeURIComponent(path);
            } catch (e) {
              // ignore
            }
            return 'docsify:' + path;
          }

          /* ---------------- 文章元信息：更新时间 / 阅读时长 / 字数 ---------------- */
          const META_CFG = {
            githubOwner: 'LoveEleve',
            githubRepo: 'LoveEleve.github.io',
            // GitHub API 未登录限流较紧：做本地缓存降低请求频率
            cacheTTLms: 6 * 60 * 60 * 1000,
            // 顶部提示文案
            tipHtml: '提示：发现错误欢迎在评论区 <b>勘误</b> / 交流～'
          };

          function getRouteFile(vm) {
            let file = (vm && vm.route && vm.route.file) ? vm.route.file : '';
            if (!file) {
              let p = (vm && vm.route && vm.route.path) ? vm.route.path : '';
              p = (p || '').split('?')[0];
              if (!p || p === '/') return 'README.md';
              if (p.endsWith('/')) p += 'README';
              if (!p.endsWith('.md')) p += '.md';
              file = p;
            }
            file = (file || '').replace(/^\//, '');
            return file || 'README.md';
          }

          function ensurePageMeta(section) {
            if (!section) return null;

            let meta = section.querySelector('#page-meta');
            if (!meta) {
              meta = document.createElement('div');
              meta.id = 'page-meta';
              meta.className = 'page-meta-card';
              meta.innerHTML = `
                <div class="page-meta-head">
                  <div class="page-meta-title">本文信息</div>
                </div>
                <div class="page-meta-body">
                  <span>最后更新：<b id="meta-updated">加载中…</b></span>
                  <span class="page-meta-sep">·</span>
                  <span>预计阅读：<b id="meta-read">-</b></span>
                  <span class="page-meta-sep">·</span>
                  <span>字数：<b id="meta-words">-</b></span>
                </div>
                <div id="page-tip" class="page-tip"></div>
              `;
              section.insertBefore(meta, section.firstChild);
            }

            const tip = meta.querySelector('#page-tip');
            if (tip) tip.innerHTML = META_CFG.tipHtml;

            return meta;
          }

          function formatCount(n) {
            if (!Number.isFinite(n)) return '-';
            if (n >= 10000) return (n / 10000).toFixed(1).replace(/\.0$/, '') + 'w';
            if (n >= 1000) return (n / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
            return String(n);
          }

          function computeReadingStats(section) {
            try {
              const clone = section.cloneNode(true);
              clone.querySelectorAll('#page-meta, #giscus, pre, code, .code-tools').forEach((el) => el.remove());
              const text = (clone.textContent || '').replace(/\s+/g, ' ').trim();

              const cn = (text.match(/[\u4e00-\u9fff]/g) || []).length;
              const enWords = (text.replace(/[\u4e00-\u9fff]/g, ' ').match(/\b[\w'-]+\b/g) || []).length;

              const minutes = Math.max(1, Math.ceil(cn / 350 + enWords / 220));
              const total = cn + enWords;
              return { minutes, total };
            } catch (e) {
              return { minutes: 1, total: 0 };
            }
          }

          function formatUpdated(iso) {
            try {
              const d = new Date(iso);
              if (Number.isNaN(d.getTime())) return '未知';
              return new Intl.DateTimeFormat('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              }).format(d);
            } catch (e) {
              return '未知';
            }
          }

          async function fetchLastUpdatedISO(file) {
            const candidates = [
              `docs/${file}`,
              file
            ];

            for (const p of candidates) {
              const cacheKey = `pageLastUpdated:${p}`;
              try {
                const cached = JSON.parse(localStorage.getItem(cacheKey) || 'null');
                if (cached && cached.iso && cached.ts && (Date.now() - cached.ts < META_CFG.cacheTTLms)) {
                  return cached.iso;
                }
              } catch (e) {
                // ignore cache parse
              }

              const url = `https://api.github.com/repos/${META_CFG.githubOwner}/${META_CFG.githubRepo}/commits?path=${encodeURIComponent(p)}&page=1&per_page=1`;

              try {
                const controller = new AbortController();
                const t = setTimeout(() => controller.abort(), 5000);

                const resp = await fetch(url, {
                  headers: { 'Accept': 'application/vnd.github+json' },
                  signal: controller.signal
                });

                clearTimeout(t);

                if (!resp.ok) continue;
                const data = await resp.json();
                const iso = data && data[0] && data[0].commit && data[0].commit.committer && data[0].commit.committer.date;
                if (iso) {
                  try {
                    localStorage.setItem(cacheKey, JSON.stringify({ iso, ts: Date.now() }));
                  } catch (e) {
                    // ignore
                  }
                  return iso;
                }
              } catch (e) {
                // ignore
              }
            }

            return '';
          }

          async function renderPageMeta(vm) {
            const section = document.querySelector('.markdown-section');
            if (!section) return;

            const meta = ensurePageMeta(section);
            if (!meta) return;

            const { minutes, total } = computeReadingStats(section);
            const readEl = meta.querySelector('#meta-read');
            const wordsEl = meta.querySelector('#meta-words');
            if (readEl) readEl.textContent = `${minutes} 分钟`;
            if (wordsEl) wordsEl.textContent = `${formatCount(total)}`;

            const file = getRouteFile(vm);
            const updatedEl = meta.querySelector('#meta-updated');
            if (updatedEl) updatedEl.textContent = '加载中…';

            const iso = await fetchLastUpdatedISO(file);
            if (updatedEl) updatedEl.textContent = iso ? formatUpdated(iso) : '未知';
          }

          /* ---------------- 右侧 TOC：自动生成 + 当前小节高亮 ---------------- */
          let tocObserver = null;

          function ensureToc() {
            let toc = document.querySelector('#toc-aside');
            if (!toc) {
              toc = document.createElement('aside');
              toc.id = 'toc-aside';
              toc.className = 'toc-aside';
              toc.innerHTML = `
                <div class="toc-head">
                  <div class="toc-title">目录</div>
                </div>
                <div class="toc-body" id="toc-body"></div>
              `;
              document.body.appendChild(toc);
            }
            return toc;
          }

          function buildTocItems(section) {
            const headings = Array.from(section.querySelectorAll('h2, h3, h4'));
            return headings
              .map((h) => {
                const level = h.tagName.toLowerCase();
                const id = h.getAttribute('id');
                const text = (h.textContent || '').trim();
                if (!id || !text) return null;
                return { el: h, id, text, level };
              })
              .filter(Boolean);
          }

          function renderToc(vm) {
            const section = document.querySelector('.markdown-section');
            if (!section) return;

            const toc = ensureToc();
            const body = toc.querySelector('#toc-body');
            if (!body) return;

            const items = buildTocItems(section);

            // 小标题太少就不展示 TOC（避免空卡片）
            if (items.length < 3) {
              toc.style.display = 'none';
              if (tocObserver) {
                try { tocObserver.disconnect(); } catch (e) {}
                tocObserver = null;
              }
              return;
            }

            toc.style.display = '';
            body.innerHTML = items
              .map((it) => {
                const cls = it.level === 'h2' ? 'toc-l2' : it.level === 'h3' ? 'toc-l3' : 'toc-l4';
                return `<a class="${cls}" href="#/${(vm && vm.route && vm.route.path ? vm.route.path : '').replace(/^\//, '')}?id=${encodeURIComponent(it.id)}" data-target="${it.id}">${escapeHtml(it.text)}</a>`;
              })
              .join('');

            const links = Array.from(body.querySelectorAll('a[data-target]'));

            function setActive(id) {
              links.forEach((a) => a.classList.toggle('is-active', a.getAttribute('data-target') === id));
            }

            // 点击：平滑滚动到 heading（不依赖 hash 变化，避免 history 垃圾）
            links.forEach((a) => {
              a.onclick = (e) => {
                e.preventDefault();
                const id = a.getAttribute('data-target');
                const target = section.querySelector(`#${CSS.escape(id)}`);
                if (target) {
                  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  setActive(id);
                }
              };
            });

            // 滚动高亮：IntersectionObserver
            if (tocObserver) {
              try { tocObserver.disconnect(); } catch (e) {}
              tocObserver = null;
            }

            let currentId = '';
            tocObserver = new IntersectionObserver(
              (entries) => {
                const visible = entries
                  .filter((en) => en.isIntersecting)
                  .sort((a, b) => (a.boundingClientRect.top - b.boundingClientRect.top));
                if (!visible.length) return;
                const id = visible[0].target.getAttribute('id') || '';
                if (id && id !== currentId) {
                  currentId = id;
                  setActive(id);
                }
              },
              { root: null, rootMargin: '-15% 0px -70% 0px', threshold: [0, 1] }
            );

            items.forEach((it) => tocObserver.observe(it.el));

            // 初始高亮：优先用 URL 的 id
            const urlId = new URLSearchParams(location.hash.split('?')[1] || '').get('id');
            if (urlId) setActive(urlId);
            else setActive(items[0].id);
          }

          /* ---------------- 阅读体验增强：进度条 / 面包屑 / 上一篇下一篇 ---------------- */
          let progressBound = false;
          let progressUpdate = null;

          function ensureProgressBar() {
            let bar = document.getElementById('read-progress');
            if (!bar) {
              bar = document.createElement('div');
              bar.id = 'read-progress';
              document.body.appendChild(bar);
            }

            function calcProgress() {
              const doc = document.documentElement;
              const scrollTop = doc.scrollTop || document.body.scrollTop || 0;
              const height = (doc.scrollHeight || 0) - (doc.clientHeight || 0);
              if (height <= 0) return 0;
              return Math.max(0, Math.min(1, scrollTop / height));
            }

            function update() {
              const pct = calcProgress();
              bar.style.width = `${(pct * 100).toFixed(2)}%`;
            }

            progressUpdate = update;

            if (!progressBound) {
              progressBound = true;
              let ticking = false;
              const onScroll = () => {
                if (ticking) return;
                ticking = true;
                requestAnimationFrame(() => {
                  ticking = false;
                  if (progressUpdate) progressUpdate();
                });
              };

              window.addEventListener('scroll', onScroll, { passive: true });
              window.addEventListener('resize', onScroll, { passive: true });
            }

            update();
          }

          function normalizePath(p) {
            if (!p) return '/';
            p = String(p).split('?')[0];
            if (!p.startsWith('/')) p = '/' + p;
            // docsify route path 一般不以 / 结尾（根路径除外）
            if (p.length > 1) p = p.replace(/\/+$/, '');
            return p || '/';
          }

          function normalizeHrefToPath(href) {
            if (!href) return '';
            const h = String(href);
            if (!h.startsWith('#')) return '';
            const afterHash = h.slice(1);
            return normalizePath(afterHash);
          }

          function getSidebarLinks() {
            const nav = document.querySelector('.sidebar-nav');
            if (!nav) return [];

            const anchors = Array.from(nav.querySelectorAll('a[href]'));
            const seen = new Set();
            const list = [];

            anchors.forEach((a) => {
              const href = a.getAttribute('href') || '';
              if (!href.startsWith('#/')) return;
              if (href === '#') return;

              const path = normalizeHrefToPath(href);
              if (!path) return;

              // 过滤掉只用于目录的 hash 链接（比如 #/xxx?id=...），我们只看 path
              const key = path;
              if (seen.has(key)) return;
              seen.add(key);

              const text = (a.textContent || '').trim();
              if (!text) return;

              list.push({ href, path, text, el: a });
            });

            return list;
          }

          function ensureBreadcrumb(section) {
            let bc = section.querySelector('#page-breadcrumb');
            if (!bc) {
              bc = document.createElement('div');
              bc.id = 'page-breadcrumb';
              bc.className = 'page-breadcrumb';
              const meta = section.querySelector('#page-meta');
              if (meta) meta.insertAdjacentElement('afterend', bc);
              else section.insertBefore(bc, section.firstChild);
            }
            return bc;
          }

          function renderBreadcrumbAndNav(vm) {
            const section = document.querySelector('.markdown-section');
            if (!section) return;

            const currentPath = normalizePath(vm && vm.route && vm.route.path ? vm.route.path : '/');
            const links = getSidebarLinks();

            // Sidebar 可能稍后才渲染好，做一次轻量重试
            if (!links.length) {
              setTimeout(() => {
                const again = getSidebarLinks();
                if (again.length) renderBreadcrumbAndNav(vm);
              }, 250);
              return;
            }

            const idx = links.findIndex((it) => it.path === currentPath);

            // 面包屑：从 sidebar DOM 向上找父级 li 的标题
            const bc = ensureBreadcrumb(section);
            let crumbHtml = '';

            function getLiLabel(li) {
              const a = li.querySelector(':scope > a');
              if (a) return (a.textContent || '').trim();
              const p = li.querySelector(':scope > p');
              if (p) return (p.textContent || '').trim();
              const span = li.querySelector(':scope > span');
              if (span) return (span.textContent || '').trim();
              const first = li.childNodes && li.childNodes[0] ? (li.childNodes[0].textContent || '') : '';
              return String(first).trim();
            }

            let currentEl = null;
            if (idx >= 0) currentEl = links[idx].el;
            else {
              // fallback：按 href 前缀匹配
              const cand = links.find((it) => it.href && normalizeHrefToPath(it.href) === currentPath);
              currentEl = cand ? cand.el : null;
            }

            const crumbs = [{ text: '首页', href: '#/' }];

            if (currentEl) {
              let li = currentEl.closest('li');
              const chain = [];
              while (li) {
                const label = getLiLabel(li);
                const a = li.querySelector(':scope > a');
                const href = a ? a.getAttribute('href') : '';
                if (label) chain.push({ text: label, href: href && href.startsWith('#/') ? href : '' });
                li = li.parentElement ? li.parentElement.closest('li') : null;
              }
              chain.reverse();
              chain.forEach((c, i) => {
                // 最后一项是当前页，不用做链接
                if (i === chain.length - 1) crumbs.push({ text: c.text, href: '' });
                else crumbs.push(c);
              });
            }

            crumbHtml = crumbs
              .map((c, i) => {
                const sep = i === 0 ? '' : '<span class="crumb-sep">/</span>';
                const text = escapeHtml(c.text);
                const node = c.href ? `<a href="${c.href}">${text}</a>` : `<span>${text}</span>`;
                return `${sep}${node}`;
              })
              .join(' ');

            bc.innerHTML = crumbHtml;

            // 上一篇 / 下一篇
            let nav = section.querySelector('#page-nav');
            if (!nav) {
              nav = document.createElement('div');
              nav.id = 'page-nav';
              nav.className = 'page-nav';
              const g = section.querySelector('#giscus');
              if (g) section.insertBefore(nav, g);
              else section.appendChild(nav);
            }

            const prev = idx > 0 ? links[idx - 1] : null;
            const next = idx >= 0 && idx < links.length - 1 ? links[idx + 1] : null;

            nav.innerHTML = `
              <a class="${prev ? '' : 'is-disabled'}" href="${prev ? prev.href : '#'}" aria-disabled="${prev ? 'false' : 'true'}">
                <div class="nav-kicker">← 上一篇</div>
                <div class="nav-title">${prev ? escapeHtml(prev.text) : '没有了'}</div>
              </a>
              <a class="${next ? '' : 'is-disabled'}" href="${next ? next.href : '#'}" aria-disabled="${next ? 'false' : 'true'}">
                <div class="nav-kicker">下一篇 →</div>
                <div class="nav-title">${next ? escapeHtml(next.text) : '没有了'}</div>
              </a>
            `;
          }

          function ensureGiscusHost() {
            const section = document.querySelector('.markdown-section');
            if (!section) return null;

            let host = section.querySelector('#giscus');
            if (!host) {
              host = document.createElement('div');
              host.id = 'giscus';
              host.innerHTML = `
                <div class="giscus-card">
                  <div class="giscus-head">
                    <div class="giscus-head-left">
                      <div class="giscus-title">评论</div>
                      <div class="giscus-meta">GitHub Discussions</div>
                    </div>
                    <a class="giscus-badge" href="https://github.com/LoveEleve/LoveEleve.github.io/discussions" target="_blank" rel="noopener noreferrer">打开讨论区</a>
                  </div>
                  <div class="giscus-body"></div>
                </div>
              `;
              section.appendChild(host);
            }

            // 兼容旧结构兜底
            if (!host.querySelector('.giscus-body')) {
              const body = document.createElement('div');
              body.className = 'giscus-body';
              host.appendChild(body);
            }

            return host;
          }

          function renderOrUpdateGiscus(term) {
            const host = ensureGiscusHost();
            if (!host) return;

            const mount = host.querySelector('.giscus-body') || host;

            // 已经有 iframe：用 postMessage 切换到新的 term
            const iframe = mount.querySelector('iframe.giscus-frame');
            if (iframe && iframe.contentWindow) {
              try {
                iframe.contentWindow.postMessage({
                  giscus: {
                    setConfig: {
                      term: term
                    }
                  }
                }, 'https://giscus.app');
                return;
              } catch (e) {
                // fallback to re-render
              }
            }

            // 首次渲染 / 兜底重渲染
            mount.innerHTML = '';
            const s = document.createElement('script');
            s.src = GISCUS_CFG.src;
            s.async = true;
            s.crossOrigin = 'anonymous';
            s.setAttribute('data-repo', GISCUS_CFG.repo);
            s.setAttribute('data-repo-id', GISCUS_CFG.repoId);
            s.setAttribute('data-category', GISCUS_CFG.category);
            s.setAttribute('data-category-id', GISCUS_CFG.categoryId);
            s.setAttribute('data-mapping', GISCUS_CFG.mapping);
            s.setAttribute('data-term', term);
            s.setAttribute('data-strict', GISCUS_CFG.strict);
            s.setAttribute('data-reactions-enabled', GISCUS_CFG.reactionsEnabled);
            s.setAttribute('data-emit-metadata', GISCUS_CFG.emitMetadata);
            s.setAttribute('data-input-position', GISCUS_CFG.inputPosition);
            s.setAttribute('data-theme', GISCUS_CFG.theme);
            s.setAttribute('data-lang', GISCUS_CFG.lang);
            host.appendChild(s);
          }

          hook.doneEach(function () {
            document.querySelectorAll('pre[data-lang]').forEach(function (pre) {
              // 避免重复初始化
              if (pre.dataset.inlineFoldInited === '1') return;
              pre.dataset.inlineFoldInited = '1';

              // 先初始化折叠（会保存 rawCode），再加工具栏
              initInlineFolding(pre);
              initToolbar(pre);
            });

            // 文章元信息：随路由切换刷新（更新时间/阅读时长/字数）
            renderPageMeta(vm);

            // 右侧目录：自动生成 + 当前小节高亮
            renderToc(vm);

            // 阅读体验：进度条 / 面包屑 / 上一篇下一篇
            ensureProgressBar();
            renderBreadcrumbAndNav(vm);

            // 评论区：随路由切换自动刷新
            renderOrUpdateGiscus(getGiscusTerm(vm));
          });
        }
      ]
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/docsify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/js/docsify-themeable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-java.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.min.js"></script>
</body>
</html>
